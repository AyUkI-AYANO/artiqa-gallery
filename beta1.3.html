<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artiqa â€” è‰ºæœ¯ç”»å»Šï¼ˆæ¸¸å®¢ / ç®¡ç†å‘˜ï¼‰</title>
  <style>
    /* ===== Base ===== */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-serif, Georgia, "Times New Roman", serif;
      color: #1a1a1a; background: #f9fafb;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
      user-select: none;
    }
    :root {
      --ink: #161616;
      --muted: #6b7280;
      --accent: #7c3aed;
      --glass: rgba(255, 255, 255, 0.55);
      --glass-stroke: rgba(0,0,0,.06);
      --card: rgba(255,255,255,.8);
      --ease: cubic-bezier(.22,.61,.36,1);
      --dur: .8s;
      --tile-bg: #ffffffaa;
    }

    /* ===== Background: soft gradient animation ===== */
    #bgfx {
      position: fixed; inset:0; width:100%; height:100%; z-index:0;
      background: linear-gradient(-45deg,#a78bfa,#60a5fa,#f472b6,#fcd34d);
      background-size: 400% 400%;
      animation: gradientShift 25s ease infinite;
      pointer-events:none;
      filter: saturate(1.05) brightness(1.02);
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ===== Header & menu ===== */
    header {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: blur(10px) saturate(1.2);
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.6));
      border-bottom: 1px solid var(--glass-stroke);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px 20px; display:flex; align-items:center; gap:14px; }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 700; letter-spacing:.5px; }
    .brand .logo { width: 28px; height: 28px; border-radius: 8px; background: conic-gradient(from 30deg, #c084fc, #60a5fa, #f472b6, #c084fc); box-shadow: 0 3px 10px rgba(124,58,237,.25) inset; }
    .spacer { flex: 1; }

    .top-actions { display:flex; gap:10px; align-items:center; }
    .menu { position:relative; display:flex; gap:14px; align-items:center; margin-left: 16px; }
    .menu .indicator{ position:absolute; bottom:-2px; height:2px; width:28px; background: linear-gradient(90deg,#a78bfa,#7c3aed); border-radius:2px; left:0; transition: transform .45s var(--ease), width .45s var(--ease); }
    .link { appearance:none; border:none; background:transparent; font-weight:600; color:#374151; cursor:pointer; padding:8px 10px; border-radius:10px; }
    .link:hover{ background:rgba(124,58,237,.08); }
    .link.active{ color:var(--accent); }

    .btn { appearance: none; border: 1px solid var(--glass-stroke); background: var(--card); padding: 8px 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: transform .25s var(--ease), box-shadow .25s var(--ease), background .25s var(--ease); }
    .btn:hover{ transform: translateY(-1px); box-shadow:0 10px 18px rgba(17,24,39,.10); }
    .btn.primary{ background: linear-gradient(180deg,#a78bfa,#7c3aed); color: #fff; border: none; }
    .btn.ghost{ background: transparent; }
    .tag { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: #eef2ff; color:#3730a3; border: 1px solid #c7d2fe; }

    .hero { max-width: 1100px; margin: 30px auto 10px; padding: 0 20px; position: relative; z-index:1; }
    .hero h1 { margin: 0 0 6px; font-size: clamp(26px, 3.5vw, 40px); line-height:1.1; letter-spacing:.3px; }
    .hero p { margin: 6px 0 0; color: var(--muted); }

    /* ===== Gallery ===== */
    .gallery {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px; padding: 22px; max-width: 1100px; margin: 0 auto 120px; position: relative; z-index:1;
    }
    .card { position: relative; overflow: hidden; border-radius: 16px; background: var(--glass); border: 1px solid var(--glass-stroke); box-shadow: 0 10px 30px rgba(17,24,39,.06); cursor: zoom-in; isolation: isolate; transition: transform .45s var(--ease), box-shadow .45s var(--ease); }
    .card img { width: 100%; height: 220px; object-fit: cover; display: block; pointer-events: none; transform: scale(1.02); transition: transform .6s var(--ease); }
    .card .meta { position: absolute; inset: auto 0 0 0; padding: 10px 12px; color: #111; backdrop-filter: blur(8px); background: linear-gradient(180deg, rgba(255,255,255,.0), rgba(255,255,255,.9)); transition: transform .45s var(--ease); }
    .card .title { font-weight: 700; font-size: 14px; }
    .card .desc { font-size: 12px; color: #374151; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .card:hover{ transform: translateY(-2px) scale(1.005); box-shadow: 0 14px 28px rgba(17,24,39,.12); }
    .card:hover img{ transform: scale(1.06); }
    .card:hover .meta{ transform: translateY(-2px); }

    /* ===== Viewer watermark ===== */
    .wm::after { content: "Â© Artiqa Gallery"; position: absolute; inset: 0; pointer-events: none; background: repeating-linear-gradient(45deg, rgba(0,0,0,.08) 0 2px, transparent 2px 18px); color: rgba(0,0,0,.12); font-size: 42px; font-weight: 800; letter-spacing:2px; display: grid; place-items: center; mix-blend-mode: multiply; text-align: center; }

    /* ===== Lightbox ===== */
    .lightbox { position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,0,0,.5); backdrop-filter: blur(4px); z-index: 210; }
    .lightbox.on { display: grid; }
    .lightbox-inner { position: relative; width: min(92vw, 980px); max-height: 86vh; background: #fff; border-radius: 18px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,.25); }
    .lightbox .imgwrap { position: relative; height: min(62vh, 600px); background:#f3f4f6; }
    .lightbox .imgwrap img { width: 100%; height: 100%; object-fit: contain; display: block; }
    .lightbox .info { padding: 14px 16px; display: flex; gap: 12px; align-items: center; border-top:1px solid #eee; }
    .lightbox .info h3 { margin: 0; font-size: 18px; }
    .lightbox .info p { margin: 0; color: var(--muted); }
    .lightbox .x { position:absolute; top:10px; right:10px; background:#fff; border:1px solid #e5e7eb; width:36px; height:36px; border-radius:10px; display:grid; place-items:center; cursor:pointer; }
    .lightbox{ opacity:0; transition: opacity .35s var(--ease); }
    .lightbox.on{ opacity:1; }
    .lightbox.on .lightbox-inner{ animation: pop .45s var(--ease) both; }
    @keyframes pop{ from{ transform: translateY(10px) scale(.985); opacity:.55 } to{ transform:none; opacity:1 } }

    /* ===== Admin panel ===== */
    .admin-bar { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; align-items:center; background: var(--card); border:1px solid var(--glass-stroke); border-radius: 16px; padding: 10px 12px; box-shadow: 0 12px 30px rgba(17,24,39,.12); z-index:55; }
    .hidden { display: none !important; }
    .field { display:flex; flex-direction: column; gap:6px; }
    .field label { font-size: 12px; color: var(--muted); }
    .input, .textarea { width: 100%; border: 1px solid #e5e7eb; border-radius: 12px; padding: 8px 10px; background: #fff; }
    .textarea { min-height: 70px; resize: vertical; }
    .panel { position: fixed; right: 16px; bottom: 82px; width: min(500px, 94vw); background: var(--card); border: 1px solid var(--glass-stroke); border-radius: 18px; padding: 12px; box-shadow: 0 16px 30px rgba(17,24,39,.1); z-index: 55; }
    .panel h3 { margin: 6px 6px 10px; }
    .panel .row { display:grid; grid-template-columns: 1fr; gap: 8px; padding: 6px; }
    .panel .row-actions { display:flex; gap:8px; justify-content:flex-end; margin-top: 6px; }

    /* ===== Sheets (About / Author / Contact) ===== */
    .modal { position: fixed; inset:0; display:none; place-items:center; background: rgba(0,0,0,.35); z-index:220; }
    .modal.on { display:grid; }
    .card-lg { width: min(420px, 92vw); background:#fff; border-radius: 16px; border: 1px solid #e5e7eb; padding: 16px; box-shadow: 0 20px 50px rgba(0,0,0,.2); }

    .sheet { position: fixed; inset: 0; display:none; place-items:center; background: rgba(0,0,0,.35); z-index: 200; }
    .sheet.on { display:grid; }
    .sheet .panel-lg { width: min(860px, 94vw); max-height: 88vh; overflow:auto; background:#fff; border-radius: 18px; border:1px solid #e5e7eb; box-shadow:0 24px 60px rgba(0,0,0,.25); }
    .sheet header { position: sticky; top:0; background:#fff; border-bottom:1px solid #eee; }
    .sheet .hd { display:flex; align-items:center; gap:8px; padding:14px 16px; }
    .sheet .hd h2 { margin:0; font-size:20px; }
    .sheet .bd { padding:16px; }
    .chip { display:inline-block; padding:4px 8px; border:1px solid #e5e7eb; border-radius:999px; font-size:12px; margin-right:6px; }
    .ver { border-left:3px solid #a78bfa; padding-left:12px; margin:12px 0; }
    .xbtn { margin-left:auto; background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:6px 10px; cursor:pointer; }
    .muted { color: var(--muted); }

    /* ===== Social tiles ===== */
    .tiles { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:12px; margin-top:10px; }
    .tile { display:flex; align-items:center; gap:10px; padding:12px; border-radius:14px; background: var(--tile-bg); border:1px solid #e5e7eb; text-decoration:none; color:#111; box-shadow: 0 4px 14px rgba(17,24,39,.06); transition: transform .25s var(--ease), box-shadow .25s var(--ease), background .25s var(--ease); }
    .tile:hover{ transform: translateY(-2px); box-shadow: 0 10px 20px rgba(17,24,39,.10); background:#fff; }
    .tile .ico { width:28px; height:28px; border-radius:8px; display:grid; place-items:center; font-size:16px; }
    .tile .lbl { font-weight:700; }

    /* ===== Reveal on scroll ===== */
    .reveal{ opacity:0; transform: translateY(12px) scale(.98); transition: opacity var(--dur) var(--ease), transform var(--dur) var(--ease); }
    .reveal.in{ opacity:1; transform:none; }

    /* ===== Layering relative to background ===== */
    header, .hero, .gallery, .admin-bar, .panel { position: relative; z-index: 1; }

    @media (prefers-reduced-motion: reduce){ *{ animation: none !important; transition: none !important; } }
  </style>
</head>
<body>
  <!-- Soft gradient background -->
  <div id="bgfx" aria-hidden="true"></div>

  <header>
    <div class="wrap">
      <div class="brand"><div class="logo"></div><div>Artiqa Gallery</div><span class="tag" id="roleBadge">æ¸¸å®¢æ¨¡å¼</span></div>
      <div class="spacer"></div>
      <nav class="menu" aria-label="ä¸»èœå•">
        <span class="indicator" id="menuIndicator"></span>
        <button class="link active" id="navGallery">ç”»å»Š</button>
        <button class="link" id="navAbout">å…³äº</button>
        <button class="link" id="navAuthor">ä½œè€…ç®€ä»‹</button>
        <button class="link" id="navContact">ä½œè€…è”ç³»æ–¹å¼</button>
      </nav>
      <div class="spacer"></div>
      <div class="top-actions">
        <button class="btn" id="loginBtn">ç®¡ç†å‘˜ç™»å½•</button>
        <button class="btn hidden" id="logoutBtn">é€€å‡ºç®¡ç†å‘˜</button>
      </div>
    </div>
  </header>

  <section class="hero">
    <h1>ç”¨è‰ºæœ¯çš„æ–¹å¼çœ‹ä¸–ç•Œ</h1>
    <p>beta1.3ï¼šç¤¾äº¤ç£è´´ + ç«™å†…å¯ç¼–è¾‘ä½œè€…èµ„æ–™ã€‚</p>
  </section>

  <main class="gallery" id="gallery" aria-live="polite"></main>

  <!-- Lightbox viewer -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true">
    <div class="lightbox-inner wm">
      <div class="imgwrap"><img id="lbImg" alt="ä½œå“å¤§å›¾"/></div>
      <button class="x" id="lbClose" aria-label="å…³é—­">âœ•</button>
      <div class="info">
        <div style="flex:1">
          <h3 id="lbTitle">æ ‡é¢˜</h3>
          <p id="lbDesc">ä»‹ç»</p>
        </div>
        <div id="lbAdminActions" class="hidden" style="display:flex; gap:8px;">
          <button class="btn" id="downloadBtn">ä¸‹è½½</button>
          <button class="btn" id="deleteBtn">åˆ é™¤</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin bar -->
  <div class="admin-bar hidden" id="adminBar">
    <input type="file" id="fileInput" class="hidden" accept="image/*" multiple>
    <button class="btn primary" id="addBtn">æ·»åŠ ä½œå“</button>
    <button class="btn" id="editBtn">ç¼–è¾‘ä½œå“ä¿¡æ¯</button>
    <button class="btn" id="profileBtn">ç¼–è¾‘ä½œè€…èµ„æ–™</button>
    <button class="btn" id="backupBtn">å¯¼å‡ºå¤‡ä»½</button>
    <button class="btn" id="restoreBtn">å¯¼å…¥å¤‡ä»½</button>
  </div>

  <!-- Edit artwork panel -->
  <div class="panel hidden" id="editPanel">
    <h3>ç¼–è¾‘ä½œå“ä¿¡æ¯</h3>
    <div class="row">
      <div class="field">
        <label for="titleInput">æ ‡é¢˜</label>
        <input id="titleInput" class="input" placeholder="å¦‚ï¼šæ— é¢˜ No.7" />
      </div>
      <div class="field">
        <label for="descInput">ä»‹ç»</label>
        <textarea id="descInput" class="textarea" placeholder="ä½œå“åˆ›ä½œèƒŒæ™¯ã€åª’ä»‹ä¸çµæ„Ÿâ€¦â€¦"></textarea>
      </div>
      <div class="row-actions">
        <button class="btn" id="saveMetaBtn">ä¿å­˜</button>
        <button class="btn ghost" id="cancelMetaBtn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- Edit profile panel (author bio & social tiles) -->
  <div class="panel hidden" id="profilePanel">
    <h3>ç¼–è¾‘ä½œè€…èµ„æ–™</h3>
    <div class="row">
      <div class="field">
        <label for="bioInput">ä½œè€…ç®€ä»‹</label>
        <textarea id="bioInput" class="textarea" placeholder="è¾“å…¥ä½œè€…è‡ªæˆ‘ä»‹ç»ã€åˆ›ä½œç†å¿µä¸ç»å†"></textarea>
      </div>
      <div class="field">
        <label>ç¤¾äº¤ç£è´´</label>
        <div id="tilesEditor"></div>
        <div class="row-actions" style="justify-content:flex-start; gap:6px; margin-top:8px;">
          <button class="btn" id="addTileBtn">æ–°å¢ç£è´´</button>
        </div>
      </div>
      <div class="row-actions">
        <button class="btn" id="saveProfileBtn">ä¿å­˜ä½œè€…èµ„æ–™</button>
        <button class="btn ghost" id="cancelProfileBtn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- About sheet -->
  <div class="sheet" id="aboutSheet" role="dialog" aria-modal="true">
    <div class="panel-lg">
      <header><div class="hd"><h2>å…³äº Artiqa</h2><button class="xbtn" id="aboutClose">å…³é—­</button></div></header>
      <div class="bd">
        <p class="muted">ä¸€ä¸ªä»¥è‰ºæœ¯æ„Ÿä¸ºæ ¸å¿ƒçš„å‰ç«¯ç”»å»Šæ¨¡æ¿ã€‚æ­¤é¡µé¢ä¸º <b>beta1.3</b> ç‰ˆæœ¬ã€‚</p>
        <h3>ç‰ˆæœ¬æ›´æ–°</h3>
        <div class="ver">
          <div class="chip">beta1.3 Â· 2025-10-01</div>
          <ul>
            <li>â€œä½œè€…è”ç³»æ–¹å¼â€æ”¹ä¸º<strong>ç£è´´å¼ç¤¾äº¤æŒ‰é’®</strong>ã€‚</li>
            <li>ç®¡ç†å‘˜å¯åœ¨ç«™å†…ç›´æ¥ç¼–è¾‘<strong>ä½œè€…ç®€ä»‹</strong>ä¸<strong>ç¤¾äº¤ç£è´´é“¾æ¥</strong>ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ã€‚</li>
          </ul>
        </div>
        <div class="ver"><div class="chip">beta1.2 Â· 2025-10-01</div>
          <ul>
            <li>èƒŒæ™¯åˆ‡æ¢ä¸ºæŸ”å’Œæ¸å˜ï¼›èœå•æŒ‡ç¤ºæ¡ä¸ z-index ä¿®å¤ã€‚</li>
          </ul>
        </div>
        <div class="ver"><div class="chip">beta1.1 Â· 2025-10-01</div>
          <ul>
            <li>â€œå…³äºâ€æ”¹ä¸ºç«™å†…é¢æ¿ï¼›æ–°å¢ä¸»èœå•ä¸ä½œè€…æ¨¡å—ã€‚</li>
          </ul>
        </div>
        <div class="ver">
          <div class="chip">beta1.0 Â· 2025-10-01</div>
          <ul>
            <li>åˆå§‹å‘å¸ƒï¼šæ¸¸å®¢/ç®¡ç†å‘˜åŒæ¨¡å¼ã€å›¾ç‰‡æ·»åŠ ä¸æœ¬åœ°å­˜å‚¨ã€ä¿¡æ¯ç¼–è¾‘ã€ä¸‹è½½/åˆ é™¤ã€å¤‡ä»½/æ¢å¤ã€è½»æ°´å°ä¸å³é”®é™åˆ¶ã€‚</li>
          </ul>
        </div>
        <p class="muted">æ³¨æ„ï¼šæœ¬æ¨¡æ¿ä¸ºçº¯å‰ç«¯æ¼”ç¤ºã€‚çœŸå®é¡¹ç›®è¯·æ¥å…¥åç«¯ä»¥å®ç°å¯é çš„é‰´æƒä¸å­˜å‚¨ã€‚</p>
      </div>
    </div>
  </div>

  <!-- Author sheet -->
  <div class="sheet" id="authorSheet" role="dialog" aria-modal="true">
    <div class="panel-lg">
      <header><div class="hd"><h2>ä½œè€…ç®€ä»‹</h2><button class="xbtn" id="authorClose">å…³é—­</button></div></header>
      <div class="bd">
        <div id="authorBio">è¿™é‡Œæ”¾ç½®ä½œè€…çš„è‡ªæˆ‘ä»‹ç»ã€åˆ›ä½œç†å¿µä¸è·å¥–ç»å†ç­‰å†…å®¹ã€‚ä½ å¯ä»¥åœ¨ HTML ä¸­ç›´æ¥ç¼–è¾‘æ­¤æ®µè½ï¼Œæˆ–åœ¨åç»­ç‰ˆæœ¬ä¸­æ”¹ä¸ºä»åç«¯è¯»å–ã€‚</div>
      </div>
    </div>
  </div>

  <!-- Contact sheet -->
  <div class="sheet" id="contactSheet" role="dialog" aria-modal="true">
    <div class="panel-lg">
      <header><div class="hd"><h2>ä½œè€…è”ç³»æ–¹å¼</h2><button class="xbtn" id="contactClose">å…³é—­</button></div></header>
      <div class="bd">
        <div class="tiles" id="contactTiles"></div>
        <p class="muted" style="margin-top:10px">æç¤ºï¼šä¸Šçº¿æ—¶å»ºè®®ç”¨è”ç³»è¡¨å• + é˜²åƒåœ¾éªŒè¯ï¼Œæˆ–ä½¿ç”¨æ— åç«¯è¡¨å•æœåŠ¡ã€‚</p>
      </div>
    </div>
  </div>

  <!-- Login modal -->
  <div class="modal" id="loginModal">
    <div class="card-lg">
      <h2 style="margin:6px 0 2px">ç®¡ç†å‘˜ç™»å½•</h2>
      <p class="muted" style="margin-top:0">æ¼”ç¤ºç”¨é€”ï¼šå‡­è¯ä»…åœ¨æœ¬åœ°æ ¡éªŒã€‚å®é™…é¡¹ç›®è¯·æ”¹ä¸ºåç«¯è®¤è¯ã€‚</p>
      <div class="field" style="margin-top:12px">
        <label for="user">ç”¨æˆ·å</label>
        <input id="user" class="input" placeholder="admin" autocomplete="username">
      </div>
      <div class="field">
        <label for="pass">å¯†ç </label>
        <input id="pass" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" type="password" autocomplete="current-password">
      </div>
      <div class="row-actions" style="margin-top:12px">
        <button class="btn" id="loginConfirm">ç™»å½•</button>
        <button class="btn ghost" id="loginCancel">å–æ¶ˆ</button>
      </div>
      <p class="muted" style="font-size:12px; margin-top:10px">é»˜è®¤å‡­è¯ï¼š<b>admin</b> / <b>art1234</b>ï¼ˆè¯·åœ¨æºç å¸¸é‡å¤„æ›´æ”¹ï¼‰</p>
    </div>
  </div>

  <!-- Card template -->
  <template id="cardTpl">
    <article class="card" role="button" tabindex="0" aria-label="æ‰“å¼€ä½œå“">
      <img alt="ä½œå“ç¼©ç•¥å›¾" />
      <div class="meta">
        <div class="title"></div>
        <div class="desc"></div>
      </div>
    </article>
  </template>

  <script>
    // ===== Constants =====
    const ADMIN_USER = 'admin';
    const ADMIN_PASS = 'art1234';

    // ===== Elements =====
    const els = {
      gallery: document.getElementById('gallery'),
      roleBadge: document.getElementById('roleBadge'),
      loginBtn: document.getElementById('loginBtn'),
      logoutBtn: document.getElementById('logoutBtn'),
      adminBar: document.getElementById('adminBar'),
      addBtn: document.getElementById('addBtn'),
      fileInput: document.getElementById('fileInput'),
      editBtn: document.getElementById('editBtn'),
      editPanel: document.getElementById('editPanel'),
      titleInput: document.getElementById('titleInput'),
      descInput: document.getElementById('descInput'),
      saveMetaBtn: document.getElementById('saveMetaBtn'),
      cancelMetaBtn: document.getElementById('cancelMetaBtn'),
      backupBtn: document.getElementById('backupBtn'),
      restoreBtn: document.getElementById('restoreBtn'),
      loginModal: document.getElementById('loginModal'),
      loginConfirm: document.getElementById('loginConfirm'),
      loginCancel: document.getElementById('loginCancel'),
      user: document.getElementById('user'),
      pass: document.getElementById('pass'),
      lightbox: document.getElementById('lightbox'),
      lbImg: document.getElementById('lbImg'),
      lbTitle: document.getElementById('lbTitle'),
      lbDesc: document.getElementById('lbDesc'),
      lbClose: document.getElementById('lbClose'),
      lbAdminActions: document.getElementById('lbAdminActions'),
      downloadBtn: document.getElementById('downloadBtn'),
      deleteBtn: document.getElementById('deleteBtn'),
      cardTpl: document.getElementById('cardTpl'),
      navGallery: document.getElementById('navGallery'),
      navAbout: document.getElementById('navAbout'),
      navAuthor: document.getElementById('navAuthor'),
      navContact: document.getElementById('navContact'),
      aboutSheet: document.getElementById('aboutSheet'),
      authorSheet: document.getElementById('authorSheet'),
      contactSheet: document.getElementById('contactSheet'),
      aboutClose: document.getElementById('aboutClose'),
      authorClose: document.getElementById('authorClose'),
      contactClose: document.getElementById('contactClose'),
      menuIndicator: document.getElementById('menuIndicator'),
      // beta1.3 profile editing
      profileBtn: document.getElementById('profileBtn'),
      profilePanel: document.getElementById('profilePanel'),
      bioInput: document.getElementById('bioInput'),
      tilesEditor: document.getElementById('tilesEditor'),
      addTileBtn: document.getElementById('addTileBtn'),
      saveProfileBtn: document.getElementById('saveProfileBtn'),
      cancelProfileBtn: document.getElementById('cancelProfileBtn'),
      authorBio: document.getElementById('authorBio'),
      contactTiles: document.getElementById('contactTiles')
    };

    // ===== State =====
    let isAdmin = false;
    let items = loadItems();
    let currentIdx = -1;
    let io = null;

    // ===== Profile (beta1.3) =====
    function defaultProfile(){
      return {
        bio: 'è¿™é‡Œæ”¾ç½®ä½œè€…çš„è‡ªæˆ‘ä»‹ç»ã€åˆ›ä½œç†å¿µä¸è·å¥–ç»å†ç­‰å†…å®¹ã€‚',
        tiles: [
          { label: 'Email', url: 'mailto:artist@example.com', color: '#fee2e2', text: '#991b1b', emoji: 'âœ‰ï¸' },
          { label: 'Instagram', url: '#', color: '#e9d5ff', text: '#6d28d9', emoji: 'ğŸ“¸' },
          { label: 'å¾®åš / å°çº¢ä¹¦', url: '#', color: '#dbeafe', text: '#1d4ed8', emoji: 'ğŸ“•' }
        ]
      };
    }
    function loadProfile(){
      const raw = localStorage.getItem('artiqa_profile');
      if (!raw) { const p=defaultProfile(); saveProfile(p); return p; }
      try { const p=JSON.parse(raw); if(!Array.isArray(p.tiles)) p.tiles=[]; return p; } catch(e){ const p=defaultProfile(); saveProfile(p); return p; }
    }
    function saveProfile(p){ localStorage.setItem('artiqa_profile', JSON.stringify(p)); }
    let profile = loadProfile();

    // ===== Data (artworks) =====
    function loadItems(){
      const raw = localStorage.getItem('artiqa_items');
      if (raw) { try { return JSON.parse(raw); } catch(e){} }
      const seed = [
        mkSeed('æ™¨é›¾ä¸­çš„æ¾æ—','å®£çº¸ / æ°´å¢¨','Misty Pines'),
        mkSeed('é™ç‰©Â·é‡‘å±ç½','æ²¹ç”» / å†™å®','Still Life'),
        mkSeed('ç´«ç½—å…° No.3','ä¸™çƒ¯ / æŠ½è±¡','Violet Abstraction')
      ];
      saveItems(seed); return seed;
    }
    function saveItems(arr){ localStorage.setItem('artiqa_items', JSON.stringify(arr)); }

    function mkSeed(title, desc, label){
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'>
        <defs>
          <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
            <stop offset='0%' stop-color='#a78bfa'/>
            <stop offset='50%' stop-color='#60a5fa'/>
            <stop offset='100%' stop-color='#f472b6'/>
          </linearGradient>
        </defs>
        <rect width='100%' height='100%' fill='url(#g)'/>
        <g font-family='Georgia, serif' fill='rgba(255,255,255,.95)'>
          <text x='50%' y='45%' font-size='64' font-weight='700' text-anchor='middle'>${title}</text>
          <text x='50%' y='58%' font-size='28' text-anchor='middle'>${label}</text>
        </g>
      </svg>`;
      return { id: crypto.randomUUID(), title, desc, dataURL: 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg))), date: Date.now() };
    }

    // ===== Render gallery =====
    function ensureObserver(){ if (io) return; io = new IntersectionObserver((entries)=>{ for(const ent of entries){ if(ent.isIntersecting) ent.target.classList.add('in'); } }, { threshold: .12 }); }
    function render(){
      els.gallery.innerHTML = '';
      ensureObserver();
      items.forEach((it, idx) => {
        const node = els.cardTpl.content.firstElementChild.cloneNode(true);
        node.classList.add('reveal');
        node.querySelector('img').src = it.dataURL;
        node.querySelector('.title').textContent = it.title || 'æ— é¢˜';
        node.querySelector('.desc').textContent = it.desc || '';
        node.addEventListener('click', () => openLightbox(idx));
        node.addEventListener('keyup', (e) => { if (e.key === 'Enter') openLightbox(idx); });
        els.gallery.appendChild(node); io.observe(node);
      });
    }

    // ===== Render profile (bio & tiles) =====
    function renderAuthor(){ els.authorBio.textContent = profile.bio || ''; }
    function renderTiles(){
      els.contactTiles.innerHTML = '';
      (profile.tiles||[]).forEach((t, i)=>{
        const a = document.createElement('a');
        a.className='tile'; a.href=t.url||'#'; a.target=(t.url||'').startsWith('mailto:')?'_self':'_blank'; a.rel='noopener';
        a.innerHTML = `<div class="ico" style="background:${t.color||'#eef2ff'}">${t.emoji||'ğŸ”—'}</div><div><div class="lbl">${t.label||'é“¾æ¥'}</div><div class="muted" style="font-size:12px;">${(t.url||'').replace(/^mailto:/,'')}</div></div>`;
        els.contactTiles.appendChild(a);
      });
    }

    // ===== Lightbox =====
    function openLightbox(idx){ currentIdx = idx; const it = items[idx]; els.lbImg.src = it.dataURL; els.lbTitle.textContent = it.title || 'æ— é¢˜'; els.lbDesc.textContent = it.desc || ''; els.lbAdminActions.classList.toggle('hidden', !isAdmin); els.lightbox.classList.add('on'); }
    function closeLightbox(){ els.lightbox.classList.remove('on'); }
    els.lbClose.addEventListener('click', closeLightbox);
    els.lightbox.addEventListener('click', (e)=>{ if(e.target===els.lightbox) closeLightbox(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeLightbox(); });

    // ===== Admin actions (artworks) =====
    els.downloadBtn.addEventListener('click', () => { if (!isAdmin || currentIdx<0) return; const it = items[currentIdx]; const a = document.createElement('a'); a.href = it.dataURL; a.download = (it.title || 'artwork') + '.png'; document.body.appendChild(a); a.click(); a.remove(); });
    els.deleteBtn.addEventListener('click', () => { if (!isAdmin || currentIdx<0) return; if (!confirm('ç¡®å®šåˆ é™¤è¯¥ä½œå“å—ï¼Ÿ')) return; items.splice(currentIdx,1); saveItems(items); render(); closeLightbox(); });

    els.editBtn.addEventListener('click', () => { if (currentIdx<0) { alert('è¯·å…ˆåœ¨ç”»å»Šä¸­æ‰“å¼€ä¸€å¹…ä½œå“å†ç¼–è¾‘ã€‚'); return; } const it = items[currentIdx]; els.titleInput.value = it.title || ''; els.descInput.value = it.desc || ''; els.editPanel.classList.remove('hidden'); });
    els.cancelMetaBtn.addEventListener('click', () => els.editPanel.classList.add('hidden'));
    els.saveMetaBtn.addEventListener('click', () => { if (currentIdx<0) return; items[currentIdx].title = els.titleInput.value.trim(); items[currentIdx].desc = els.descInput.value.trim(); saveItems(items); render(); els.lbTitle.textContent = items[currentIdx].title || 'æ— é¢˜'; els.lbDesc.textContent = items[currentIdx].desc || ''; els.editPanel.classList.add('hidden'); });

    els.addBtn.addEventListener('click', () => els.fileInput.click());
    els.fileInput.addEventListener('change', async (e) => { const files = Array.from(e.target.files || []); for (const f of files) { if (!f.type.startsWith('image/')) continue; const dataURL = await fileToDataURL(f); items.unshift({ id: crypto.randomUUID(), title: f.name.replace(/\.[^.]+$/, ''), desc: '', dataURL, date: Date.now() }); } saveItems(items); render(); e.target.value = ''; });
    function fileToDataURL(file){ return new Promise((resolve,reject)=>{ const r=new FileReader(); r.onload=()=>resolve(r.result); r.onerror=reject; r.readAsDataURL(file); }); }

    // ===== Admin actions (profile beta1.3) =====
    els.profileBtn.addEventListener('click', ()=>{
      // populate editor
      els.bioInput.value = profile.bio || '';
      renderTilesEditor();
      els.profilePanel.classList.remove('hidden');
    });
    els.cancelProfileBtn.addEventListener('click', ()=> els.profilePanel.classList.add('hidden'));
    els.addTileBtn.addEventListener('click', ()=>{
      (profile.tiles ||= []).push({label:'æ–°ç£è´´', url:'#', color:'#eef2ff', text:'#1f2937', emoji:'ğŸ”—'});
      renderTilesEditor();
    });
    els.saveProfileBtn.addEventListener('click', ()=>{
      // collect values
      profile.bio = els.bioInput.value.trim();
      const rows = els.tilesEditor.querySelectorAll('[data-row]');
      const next = [];
      rows.forEach(r=>{
        const label = r.querySelector('[data-k="label"]').value.trim();
        const url = r.querySelector('[data-k="url"]').value.trim();
        const color = r.querySelector('[data-k="color"]').value.trim() || '#eef2ff';
        const text = r.querySelector('[data-k="text"]').value.trim() || '#1f2937';
        const emoji = r.querySelector('[data-k="emoji"]').value.trim() || 'ğŸ”—';
        if(label && url) next.push({label,url,color,text,emoji});
      });
      profile.tiles = next;
      saveProfile(profile);
      renderAuthor(); renderTiles();
      els.profilePanel.classList.add('hidden');
    });

    function tileRow(t, idx){
      const wrap = document.createElement('div');
      wrap.setAttribute('data-row', idx);
      wrap.style.cssText = 'display:grid; grid-template-columns: 1.2fr 2fr 120px 120px 70px auto; gap:8px; align-items:end; margin:8px 0;';
      wrap.innerHTML = `
        <div class="field"><label>åç§°</label><input class="input" data-k="label" value="${t.label||''}"></div>
        <div class="field"><label>é“¾æ¥</label><input class="input" data-k="url" value="${t.url||''}" placeholder="https:// æˆ– mailto:"></div>
        <div class="field"><label>èƒŒæ™¯è‰²</label><input class="input" data-k="color" value="${t.color||'#eef2ff'}" placeholder="#e5e7eb"></div>
        <div class="field"><label>æ–‡å­—è‰²</label><input class="input" data-k="text" value="${t.text||'#1f2937'}" placeholder="#111827"></div>
        <div class="field"><label>è¡¨æƒ…</label><input class="input" data-k="emoji" value="${t.emoji||'ğŸ”—'}" placeholder="ğŸ”—"></div>
        <button class="btn ghost" data-del>åˆ é™¤</button>`;
      wrap.querySelector('[data-del]').addEventListener('click', ()=>{
        profile.tiles.splice(idx,1); renderTilesEditor();
      });
      return wrap;
    }
    function renderTilesEditor(){
      els.tilesEditor.innerHTML='';
      (profile.tiles||[]).forEach((t,i)=> els.tilesEditor.appendChild(tileRow(t,i)));
      if((profile.tiles||[]).length===0){
        els.tilesEditor.innerHTML = '<div class="muted">æš‚æ— ç£è´´ï¼Œç‚¹å‡»â€œæ–°å¢ç£è´´â€æ·»åŠ ã€‚</div>';
      }
    }

    // ===== Auth =====
    function setRole(admin){
      isAdmin = !!admin;
      els.roleBadge.textContent = admin ? 'ç®¡ç†å‘˜æ¨¡å¼' : 'æ¸¸å®¢æ¨¡å¼';
      els.loginBtn.classList.toggle('hidden', admin);
      els.logoutBtn.classList.toggle('hidden', !admin);
      els.adminBar.classList.toggle('hidden', !admin);
      if (!admin) {
        document.body.style.userSelect = 'none';
        document.addEventListener('contextmenu', blockCtx, {capture:true});
        document.addEventListener('dragstart', blockEvt, {capture:true});
      } else {
        document.body.style.userSelect = 'auto';
        document.removeEventListener('contextmenu', blockCtx, {capture:true});
        document.removeEventListener('dragstart', blockEvt, {capture:true});
      }
    }
    function blockCtx(e){ e.preventDefault(); }
    function blockEvt(e){ e.preventDefault(); }

    els.loginBtn.addEventListener('click', () => { els.loginModal.classList.add('on'); setTimeout(()=>els.user.focus(), 50); });
    els.loginCancel.addEventListener('click', () => els.loginModal.classList.remove('on'));
    els.loginConfirm.addEventListener('click', doLogin);
    els.pass.addEventListener('keydown', (e)=>{ if(e.key==='Enter') doLogin(); });
    function doLogin(){ const u = els.user.value.trim(); const p = els.pass.value; if (u===ADMIN_USER && p===ADMIN_PASS){ els.loginModal.classList.remove('on'); setRole(true); els.user.value=''; els.pass.value=''; } else { alert('ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®'); } }
    els.logoutBtn.addEventListener('click', () => setRole(false));

    // ===== Sheets nav =====
    function openSheet(el){ el.classList.add('on'); }
    function closeSheet(el){ el.classList.remove('on'); }
    els.navGallery.addEventListener('click', ()=>{ document.documentElement.scrollTo({top:0, behavior:'smooth'}); setActive(els.navGallery); moveIndicator(els.navGallery); });
    els.navAbout.addEventListener('click', ()=>{ openSheet(els.aboutSheet); setActive(els.navAbout); moveIndicator(els.navAbout); });
    els.navAuthor.addEventListener('click', ()=>{ openSheet(els.authorSheet); setActive(els.navAuthor); moveIndicator(els.navAuthor); });
    els.navContact.addEventListener('click', ()=>{ openSheet(els.contactSheet); setActive(els.navContact); moveIndicator(els.navContact); });
    els.aboutClose.addEventListener('click', ()=> closeSheet(els.aboutSheet));
    els.authorClose.addEventListener('click', ()=> closeSheet(els.authorSheet));
    els.contactClose.addEventListener('click', ()=> closeSheet(els.contactSheet));
    ;[els.aboutSheet, els.authorSheet, els.contactSheet].forEach(s=>{ s.addEventListener('click', (e)=>{ if(e.target===s) closeSheet(s); }); });

    function setActive(btn){ [els.navGallery, els.navAbout, els.navAuthor, els.navContact].forEach(b=>b.classList.remove('active')); btn.classList.add('active'); }
    function moveIndicator(el){ const w = Math.max(28, el.offsetWidth * 0.6); const x = el.offsetLeft + (el.offsetWidth - w)/2; els.menuIndicator.style.width = w + 'px'; els.menuIndicator.style.transform = `translateX(${x}px)`; }

    // ===== Init =====
    window.addEventListener('DOMContentLoaded', ()=>{
      render();
      renderAuthor();
      renderTiles();
      setRole(false);
      moveIndicator(els.navGallery);
      runTests();
    });
    window.addEventListener('resize', ()=>{ const active = document.querySelector('.menu .link.active') || els.navGallery; moveIndicator(active); });

    // ===== Self-tests =====
    function runTests(){
      try {
        console.group('%cArtiqa self-test','color:#7c3aed;font-weight:bold');
        console.assert(Array.isArray(items) && items.length>=1, 'åˆå§‹ä½œå“æ•°æ®å­˜åœ¨');
        console.assert(els.gallery.childElementCount>=1, 'ç”»å»Šæ¸²æŸ“è‡³å°‘1å¼ å¡ç‰‡');
        openLightbox(0); console.assert(els.lightbox.classList.contains('on'), 'Lightbox èƒ½æ‰“å¼€'); closeLightbox(); console.assert(!els.lightbox.classList.contains('on'), 'Lightbox èƒ½å…³é—­');
        setRole(false); console.assert(els.adminBar.classList.contains('hidden'), 'æ¸¸å®¢æ¨¡å¼ä¸‹ adminBar éšè—');
        const t0 = getComputedStyle(els.menuIndicator).transform; els.navAbout.click(); const t1 = getComputedStyle(els.menuIndicator).transform; console.assert(t0!==t1, 'ç‚¹å‡»èœå•æŒ‡ç¤ºæ¡ç§»åŠ¨');
        const ziHeader = parseInt(getComputedStyle(document.querySelector('header')).zIndex)||0; const ziSheet = parseInt(getComputedStyle(els.aboutSheet).zIndex)||0; const ziLightbox = parseInt(getComputedStyle(els.lightbox).zIndex)||0; console.assert(ziSheet>ziHeader && ziLightbox>ziHeader, 'å¼¹å±‚è¦†ç›– header');
        // æ–°å¢ï¼šèµ„æ–™æ¸²æŸ“æµ‹è¯•
        console.assert(els.authorBio.textContent.length>=0, 'ä½œè€…ç®€ä»‹å·²æ¸²æŸ“');
        console.assert(els.contactTiles.childElementCount>=1, 'ç¤¾äº¤ç£è´´è‡³å°‘1ä¸ª');
        console.groupEnd();
      } catch(e){ console.error('Self-test å¤±è´¥ï¼š', e); }
    }
  </script>
</body>
</html>